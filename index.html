<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />

  <title>
     영원 &middot; 웹 개발과 일상
    
  </title>

  
  <link rel="canonical" href="https://tocktock.github.io/" />
  

  <link rel="stylesheet" href="https://tocktock.github.io/public/css/poole.css" />
  <link rel="stylesheet" href="https://tocktock.github.io/public/css/syntax.css" />
  <link rel="stylesheet" href="https://tocktock.github.io/public/css/lanyon.css" />

  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400"
  />

  <link
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
    href="https://tocktock.github.io/public/apple-touch-icon-precomposed.png"
  />
  <link rel="shortcut icon" href="https://tocktock.github.io/public/favicon.ico" />

  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS"
    href="https://tocktock.github.io/atom.xml"
  />

  <!-- <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "//www.google-analytics.com/analytics.js",
      "ga"
    );
    ga("create", "UA-178749172-1", "auto");
    ga("send", "pageview");
  </script> -->
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" />

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item description">
    <p>Developer with Cat</p>
  </div>

  <nav class="sidebar-nav">
    <a
      class="sidebar-nav-item active"
      href="https://tocktock.github.io/"
      >Home</a
    >
                
    <div>
      <a
        class="sidebar-nav-item"
        href="https://tocktock.github.io/about/"
        >About me</a
      >
               
    <div>
      <a
        class="sidebar-nav-item"
        href="https://tocktock.github.io/categories/"
        >Categories</a
      >
      
      <ul class="sidebar-categories">
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/Algorithms"
            >Algorithms (28)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/Jekyll"
            >Jekyll (1)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/elasticsearch"
            >elasticsearch (9)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/NestJS"
            >NestJS (3)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/DevTip"
            >DevTip (1)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/nodejs"
            >nodejs (1)</a
          >
        </li>
        
      </ul>
                                                                   
    </div>

    <a class="sidebar-nav-item" href="https://github.com/Tocktock/tocktock.github.io">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">영원</a>
            <small>웹 개발과 일상</small>
          </h3>
        </div>
      </div>

      <div class="container content"><div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://tocktock.github.io/nodejs/nodejs-1-what-is-nodejs/"> Node.js 의 특징과 한계 </a>
    </h1>

    <span class="post-date">01 Feb 2021</span>

    <h2 id="-nodejs-등장하다">🤗 Node.JS 등장하다!!</h2>

<p>초기 웹 페이지는 지금처럼 동적이지 않고 정적이었습니다.
그런데 동적으로 좀 움직이면 좋겠는데.. 하고 나온 것이 Javascript 입니다.
Javascript Javascript 는 브라우저의 자바스크립트 엔진을 통해 DOM Context 를 제어하며 동적인 웹페이지를 만들 수 있었습니다.</p>

<p>시간이 흘러 2008 년 구글이 크롬을 발표하면서 V8 자바스크립트 엔진을 만들게 됩니다.
이전과는 다르게 상당한 수준의 퍼포먼스를 보이며 자바스크립트를 다른 분야에 적용하자는 의견이 생기기 시작했습니다. 이후 CommonJS 표준이 발표되고 곧바로 CommonJS 와 V8 엔진을 기반으로 Node.js 가 탄생합니다.</p>

<h2 id="-nodejs-가-빛나기-시작했어">😊 Node.js 가 빛나기 시작했어!!</h2>

<p>Node.js 는 다음과 같은 특징을 가지고 있습니다.</p>

<ul>
  <li>None Blocking</li>
  <li>Event Driven</li>
  <li>Data Intensive</li>
  <li>I/O Intensive</li>
</ul>

<p>사실 위의 특징 모두 Node.js 의 비동기 이벤트 기반 아키텍처 때문입니다.</p>

<h2 id="-쓰레드-기반-vs-비동기-이벤트-기반">😃 쓰레드 기반 vs 비동기 이벤트 기반</h2>

<p>Node.js 가 개발된 배경과 목적에는 다수의 연결을 효율적으로 관리하고 비용을 최소화 할 수 있는 방법을 제시하는 것이 있었습니다. 이를 설명하기 위해 기존의 Multi Thread 환경에 대해서 알아봅시다.</p>

<p>Multi Thread 기반의 서버는 클라이언트가 웹 서버에 요청을 하게 되면 서버에서는</p>

<ul>
  <li>일정한 메모리 공간을 사용해 새로운 Thread 를 생성하거나 또는</li>
  <li>Thread pool 에서 적당한 Thread 를 해당 요청에 할당하게 됩니다.</li>
</ul>

<p>이 할당된 Thread 는 해당 요청이 완료될 때 까지 이 요청에 할당됩니다. 하지만 실제로 코드가 수행되는 속도와 I/O 장치의 수행 속도가 다르기 때문에 Blocking I/O 에 대한 문제가 생기게 됩니다.</p>

<p>Blocking I/O 자체가 발생시키는 문제는</p>

<ul>
  <li>I/O 요청을 하고 응답이 올 때까지 아무것도 하지 않고 시간을 낭비하는 것과</li>
  <li>스케쥴링 처리와 문맥 전환시 CPU 연산이 필요하기 때문에</li>
</ul>

<p>쓰레드가 많아질 수록 이로 인한 성능 저하가 일어난다는 것 입니다.</p>

<p>Node.js 는 Single Thread 기반으로 작동합니다.</p>

<p>뭐 ?? <strong>Single Thread 면 요청 기다리는 동안 아무것도 못하잖아!!</strong></p>

<p>오.. 오해입니다!!</p>

<p>Node.js 는 <strong>Single Thread 기반 비동기 처리 방식</strong> 으로 구동됩니다.</p>

<p>Node.js 는</p>

<ul>
  <li>I/O 작업 처리에 대한 응답을 기다리지 않고 바로 다음 작업을 실행합니다.</li>
  <li>대신 I/O 작업이 종료되면 이벤트를 발생시키고,</li>
  <li>이 이벤트는 해당 프로세스의 이벤트 큐에 등록되게 됩니다.</li>
  <li>노드가 이 이벤트 큐를 주기적으로 계속 감지하여 해당 이벤트 이후 수행해야 할 작업을 하게 됩니다.</li>
</ul>

<p><strong>이벤트 루프</strong> 는 작업을 요청하면서 그 작업이 완료되었을 때 어떤 작업을 진행할지에 대한 콜백함수를 지정하여 동작이 완료되었을 때 해당 콜백함수를 실행하는 동작 방식을 말합니다. 만약 HTTP 요청이 서버에 오면 이벤트 루프는 이를 감지하고 적당한 Worker Thread 를 생성하여 해당 요청을 할당한 후 다른 요청을 기다리게 됩니다.</p>

<p>다시 말해 이벤트 루프는 어떤 요청이 발생하면 그 작업에 대해 <strong>쓰레드 실행만을 일으킬 뿐</strong>입니다. 이후 작업을 할당받았던 해당 쓰레드가 모든 작업을 마치면 미리 전달받은 콜백 함수를 실행하도록 이벤트 루프로 응답하게 되며 이벤트 루프는 이것을 실행하여 클라이언트에게 결과를 응답해줍니다.</p>

<h2 id="-nodejs-의-한계">🙀 Node.js 의 한계</h2>

<p>Node.js : <strong>Culculte Intensive</strong> 한 분야는 자신 없어!!</p>

<p>다음과 같은 상황을 봅시다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</code></pre></div></div>

<p>감이 오십니까??</p>

<p>다시 말하자면 Node.js 는 Single Thread 기반입니다. 위 상황과 같이 긴 시간이 필요한 연산이 있으면 거기서 Block 이 됩니다.</p>

<p>반면 Multi Thread 기반의 어떤 Thread 가 위와 같은 요청을 받고 연산을 한다해도 여러 Thread 가 있으니 다른 요청을 받을 수 있습니다.</p>

<blockquote>
  <p>Thread 는 시분할 또는 특정 조건에 해당하는 기간동안 수행되고 Context Switching 을 통해 작업을 미루게 됩니다.</p>
</blockquote>

<p>따라서 단순히 연산에 집중적인 분야에 대해서는 Node.js 가 아닌 다른 언어 다른 코드로 작성하는 방법으로 우회하시는게 좋습니다.</p>

<hr />

<h2 id="-마치며">😭 마치며</h2>

<p>사실 Node.js 환경을 사용하면서, 단순히 백엔드랑 프론트엔드 둘 다 사용가능하니까 !! 라는 지식만 가지고</p>

<p>왜 Node.js 가 무엇을 목적으로 탄생했는지 어떤점에 강점을 가지는지에 대해서는 몰랐던것 같습니다.
생각보다 Performance 도 훌륭하다는 것에 놀랐고 Single Thread 의 비동기 이벤트 기반 수행과정에 다시 놀랐습니다.
최소한 왜 쓰는지 이 환경의 장점이 무엇인지는 아는 것이 중요한 것 같습니다.</p>

<blockquote>
  <p>Node.js 직군 면접을 보면서 특히 더 많이 느꼇습니다.</p>
</blockquote>

<p>추가로, Node.js 도 어떤 부분에서는 Multi Thread 요소를 쓰기도 합니다.
이 부분에 대해서는 다른 내용과 함께 더 좋은 정보를 가지고 다시 찾아뵙겠습니다.!!</p>

<p>출처</p>

<ul>
  <li><a href="https://zbulletjournal.tistory.com/85">https://zbulletjournal.tistory.com/85</a></li>
  <li><a href="https://m.blog.naver.com/hhw1990/221394005779">https://m.blog.naver.com/hhw1990/221394005779</a></li>
  <li><a href="https://www.youtube.com/watch?v=UCd6LorxpkY&amp;list=PLqq-6Pq4lTTa-d0iZg41U2RDqECol9C5B&amp;index=6">https://www.youtube.com/watch?v=UCd6LorxpkY&amp;list=PLqq-6Pq4lTTa-d0iZg41U2RDqECol9C5B&amp;index=6</a></li>
  <li><a href="https://sjh836.tistory.com/149">https://sjh836.tistory.com/149</a></li>
  <li><a href="https://edu.goorm.io/learn/lecture/557/%ED%95%9C-%EB%88%88%EC%97%90-%EB%81%9D%EB%82%B4%EB%8A%94-node-js">https://edu.goorm.io/learn/lecture/557/%ED%95%9C-%EB%88%88%EC%97%90-%EB%81%9D%EB%82%B4%EB%8A%94-node-js</a></li>
</ul>

    <hr />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://tocktock.github.io/nestjs/nestjs-3-database/"> NestJS 블로그 만들기 - 데이터베이스 연결 </a>
    </h1>

    <span class="post-date">01 Feb 2021</span>

    <h1 id="2-nestjs-블로그-만들기---데이터베이스-연결-postgresql과-user-모듈">2. NestJS 블로그 만들기 - 데이터베이스 연결 (Postgresql)과 User 모듈</h1>

<hr />

<blockquote>
  <p>저는 오늘 포스팅할 분량의 앱을 만든 후 블로그 포스팅하기 때문에 중간에 오류가 생길 수도 있습니다.
오류 내용과 함께 댓글을 달아주시면 저도 알아보겠습니다!!</p>
</blockquote>

<h2 id="-데이터-베이스-연결하기-">👌 데이터 베이스 연결하기 !!</h2>

<h3 id="postgresql-설치">PostgreSQL 설치!!</h3>

<p>여러분 드디어 데이터베이스에 연결할 시간이 왔습니다!!.
실제 연습할 때는 배열 같은 임의 적인 놈을 만들고 나서 하긴하지만… 바로 연결해보죠!</p>

<p>저희는 Postgresql 을 사용할 겁니다!! 다른 데이터베이스를 사용하셔도 됩니다!!</p>

<blockquote>
  <p>Postgresql 은 오픈소스 데이터베이스로 SQL 표준을 잘 지원합니다. 일단 무료입니다!!
설치하는 방법은 정식 문서나 타 블로그 포스트를 참조해주세요. <a href="https://junlab.tistory.com/177">postgresql 설치방법</a></p>
</blockquote>

<p>편의를 위해 pgAdmin 툴을 이용하여 postgresql 을 제어하겠습니다.!!</p>

<p>기존의 서버 (PostgreSQL 13 이군요 저는) 를 우클릭하여 데이터베이스를 만듭시다!!
저는 데이터베이스 이름을 <code class="language-plaintext highlighter-rouge">nest_blog</code> 라고 했습니다!!</p>

<blockquote>
  <p>원하시는 서버를 만들고 데이터베이스를 생성하셔도 괜찮습니다.</p>
</blockquote>

<p>데이터베이스의 스키마 구조에 대해서는 아직 정의하지 않겠습니다. NestJS가 해줄거거든요!!</p>

<h3 id="typeorm-">TypeORM !!</h3>

<p>TypeORM 은 NodeJS 환경에서 사용할 수 있는 ORM (Object Relational Mapping) 라이브러리 입니다!!</p>

<blockquote>
  <p>ORM 은 간단히 말해 Object 를 Database 스키마에 적절하게 적용시키게 해주는 기능이라 생각하면 편합니다.!!</p>
</blockquote>

<p>설치 설치~ nestjs 루트 폴더에서 다음 명령어로 설치해주세요 !!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nv">$ </span>npm <span class="nb">install </span>typeorm @nestjs/typeorm <span class="nt">--save</span>
</code></pre></div></div>

<p>설치가 됬으면 <code class="language-plaintext highlighter-rouge">ormconfig.json</code> 이라는 파일을 루트 폴더에 만들어 줍니다.
나중에 TypeORM 모듈이 이 파일을 참고해 데이터베이스에 연결을 시도합니다!!</p>

<p>다음과 같이 입력해주세요!!</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"postgres"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">5432</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"postgres"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="err">여러분이</span><span class="w"> </span><span class="err">설정했던</span><span class="w"> </span><span class="err">비밀번호!</span><span class="p">,</span><span class="w">
  </span><span class="nl">"database"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nest_blog"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dist/**/**.entity{.ts,.js}"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"synchronize"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">type</code> : 우리가 사용하게 될 데이터베이스 시스템을 나타냅니다.</li>
  <li><code class="language-plaintext highlighter-rouge">host</code> : db 연결 주소입니다. 기본적으로 <code class="language-plaintext highlighter-rouge">localhost</code> 를 이용하고 db 를 다른 머신에서 실행한다면 그 머신에 접속하기 위한 주소로 변경해주시면 됩니다.</li>
  <li><code class="language-plaintext highlighter-rouge">port</code> : db 연결 포트 입니다. 기본은 <code class="language-plaintext highlighter-rouge">5432</code> 입니다.</li>
  <li><code class="language-plaintext highlighter-rouge">username</code> : 별 다른 설정을 안했다면 <code class="language-plaintext highlighter-rouge">postgres</code> 입니다</li>
  <li><code class="language-plaintext highlighter-rouge">password</code> : 설치 과정에서 설정했던 비밀번호를 입력하세요.</li>
  <li><code class="language-plaintext highlighter-rouge">database</code> : 위에서 만들었던 데이터베이스의 이름을 입력하시면 됩니다. 저는 <code class="language-plaintext highlighter-rouge">nest_blog</code> 라고 했습니다.</li>
  <li><code class="language-plaintext highlighter-rouge">entities</code> : 반드시 <code class="language-plaintext highlighter-rouge">dist</code> 아래의 폴더로 지정해주세요. 안그러면 오류날 수도 있습니다. 이 설정의 경로에 있는 파일을 참고하여 DB 에서 스키마를 설정하게 됩니다.</li>
  <li><code class="language-plaintext highlighter-rouge">synchronize</code> : 이 설정을 true 로 하시면 앱 작동시 DB 스키마가 자동으로 생성되게 됩니다.</li>
</ul>

<blockquote>
  <p>자세한 내용은 <a href="https://typeorm.io/#/using-ormconfig">ormconfig 탐방하기!!</a> 을 참조해주세요~</p>
</blockquote>

<h3 id="app-모듈에서-import--그리고-실행">app 모듈에서 import !! 그리고 실행!!</h3>

<p>자 이제 <code class="language-plaintext highlighter-rouge">app.moudle.ts</code> 파일로 가서 TypeOrmMoudle 을 import 해줍시다!!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">UsersModule</span><span class="p">,</span> <span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">()],</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppController</span><span class="p">],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppService</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ormconfig.json</code> 파일을 생성하지 않았다면, forRoot 함수 안에 설정 내용을 적으셔야 합니다.!!
파일로 관리하는게 더 편하겠죠~?</p>

<p>자 이제 루트 폴더에서 다음과 같은 명령어를 수행해봅시다!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run start
</code></pre></div></div>

<p>별 다른 오류가 없다면 정상적으로 연결 된겁니다!! 우라하!!!
저희는 아직 Entity에 대해서 설정을 하지 않았기 때문에 테이블에 별 내용은 없습니다.</p>

<p>이후에 Entity 를 만든 후에는 DB 에서 테이블을 삭제하고 다시 연결해주시면 만든 내용이 적용됩니다!</p>

<h2 id="-user-entity-만들기">🛴 User Entity 만들기.</h2>

<p>톡.</p>

<p>DB 도 연결했겠다.</p>

<p>톡톡.</p>

<p>User Entity Template 도 생성했겠다.</p>

<p>톡톡.</p>

<p>내용만 넣으면 되네?</p>

<p>짝!</p>

<p><code class="language-plaintext highlighter-rouge">src/users</code> 안의 구조를 다음과 같이 해주세요!!
spec 파일들은 지금 없어도 됩니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>users
│  users.repository.ts
│  users.controller.spec.ts
│  users.controller.ts
│  users.entity.ts
│  users.module.ts
│  users.service.spec.ts
│  users.service.ts
│
└─dto
        create-user.dto.ts
        index.ts
        update-user.dto.ts
</code></pre></div></div>

<p>우리는 User 의 요구사항 맞게 적절히 Entity 를 설계해야 합니다. 왜냐면 이 안에 있는 내용이 데이터베이스 테이블 스키마로 적용될 녀석들이거든요!!</p>

<p><a href="https://github.com/Tocktock/nest-practice">요구사항보기</a></p>

<p>바로 모든 요구사항을 만족시키기는 복잡하니 할 수 있는거 먼저 채워 나갑시다!!</p>

<p><code class="language-plaintext highlighter-rouge">users.entity.ts</code> 안을 다음과 같이 채워주세요!!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BeforeInsert</span><span class="p">,</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">PrimaryGeneratedColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">argon2</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">argon2</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">(</span><span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserEntity</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">()</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">32</span> <span class="p">})</span>
  <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">({</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">BeforeInsert</span><span class="p">()</span>
  <span class="k">async</span> <span class="nx">hashPassword</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">argon2</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">({</span> <span class="na">default</span><span class="p">:</span> <span class="dl">""</span> <span class="p">})</span>
  <span class="nx">imageLink</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@Entity</code> : 이 annotation 이 있으면 nestjs가 보고 있다가 DB 스키마 적용을 위해 참고하게 됩니다!! 이후 repository 클래스에서도 참고할 수 있는 클래스가 됩니다. 괄호안에 넣은 내용이 테이블의 이름이 됩니다.</li>
  <li><code class="language-plaintext highlighter-rouge">PrimaryGeneratedColumn</code> : 이 annotion이 있다면 이 테이블은 해당 필드가 primary key 가 됩니다. 괄호 안에 아무런 내용을 넣지 않으면 id 는 auto increment 가 적용됩니다.
    <blockquote>
      <p><a href="https://velog.io/@qnfmtm666/series/DevTip">uuid vs auto increment</a></p>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Column</code> : 이 annotion 이 있으면 테이블의 필드로 만들어지게 됩니다. 괄호 안에 여러 옵션을 넣을 수 있습니다. <a href="https://typeorm.io/#/entities/column-options">모든 괄호 안의 옵션 보기</a></li>
  <li><code class="language-plaintext highlighter-rouge">BeforeInsert</code> : 요 녀석은 데이터베이스에 insert 하기 전에 수행되는 녀석입니다. 비밀번호를 복호화 할 수 없게 hash 함수를 이용해 저장합시다.</li>
</ul>

<p>아참 해쉬 함수를 쓰기 위해 argon2 를 설치해야 합니다.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>argon2 <span class="nt">--save</span>
</code></pre></div></div>

<h2 id="-repository-와-dto-변경하기">🔨 Repository 와 Dto 변경하기!</h2>

<h3 id="repository">Repository</h3>

<p><code class="language-plaintext highlighter-rouge">Repository</code> 는 우리가 만든 Entity 를 관리(insert, update, delete, load, etc.)해줄 녀석이라고 보시면 됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">users.repository.ts</code> 안의 내용을 다음과 같이 채워주세요!!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">EntityRepository</span><span class="p">,</span> <span class="nx">Repository</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UserEntity</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./users.entity</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">EntityRepository</span><span class="p">(</span><span class="nx">UserEntity</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserRepository</span> <span class="kd">extends</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">UserEntity</span><span class="o">&gt;</span> <span class="p">{}</span>
</code></pre></div></div>

<p>엥? 이것만 해도 되는건가??</p>

<ul>
  <li>네!!</li>
</ul>

<p>이렇게 Repository 를 만들어주시면 UserEntity에 대해 기본적인 쿼리를 그냥 쓸 수 있습니다.
복잡한 쿼리는 여기서 만들어주셔도 되고 이후 나올 query builder 로 해당 클래스에서 쓰셔도 됩니다!</p>

<h3 id="dto">DTO</h3>

<p><strong>DTO</strong>(Data Transfer Object) 는 데이터가 어떤 구조로 전송되는지에 대한 정보를 담고 있는 클래스 입니다.</p>

<p>dto 폴더 안에
<code class="language-plaintext highlighter-rouge">create-user.dto.ts</code> 폴더에 다음과 같이 작성해주세요</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">IsNotEmpty</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">class-validator</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateUserDto</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="k">readonly</span> <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="k">readonly</span> <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="k">readonly</span> <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">class-validator</code> 는 data 가 전송될 때 해당 필드가 적절한 유효성을 가지는지 검사해주는 라이브러리 입니다.</p>

<p>자 이제 Service 만 바꾸면 됩니다!!</p>

<h2 id="-user-service-변경하기">🤗 User Service 변경하기!!</h2>

<p>자 구조는 준비 되었습니다. 이제 로직만 잘 작성해주면 됩니다 화이팅!!</p>

<p>먼저 의존성 주입을 위해 UserService 생성자에 다음과 같이 적어줍시다!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">userRepository</span><span class="p">:</span> <span class="nx">UserRepository</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>

<p>자 이것 만으로 객체가 주입됬습니드어어어!! 얼마나 좋아~!</p>

<h3 id="user-create">User create</h3>

<p><code class="language-plaintext highlighter-rouge">users.service.ts</code> 파일 내에 create 함수 안을 다음과 같이 바꿔주세요!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">createUserDto</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">createUserDto</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">getByUserName</span> <span class="o">=</span> <span class="nx">getRepository</span><span class="p">(</span><span class="nx">UserEntity</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">createQueryBuilder</span><span class="p">(</span><span class="dl">'</span><span class="s1">user</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="dl">'</span><span class="s1">user.username = :username</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">username</span> <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">byUserName</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getByUserName</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">byUserName</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span> <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">UserName is already exists</span><span class="dl">'</span> <span class="p">};</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpException</span><span class="p">(</span>
        <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Input data validation falied</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span> <span class="p">},</span>
        <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">getByEmail</span> <span class="o">=</span> <span class="nx">getRepository</span><span class="p">(</span><span class="nx">UserEntity</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">createQueryBuilder</span><span class="p">(</span><span class="dl">'</span><span class="s1">user</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="dl">'</span><span class="s1">user.email = :email</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">byEmail</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getByEmail</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">byEmail</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span> <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">email is already exists</span><span class="dl">'</span> <span class="p">};</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpException</span><span class="p">(</span>
        <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Input data validation falied</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span> <span class="p">},</span>
        <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// const thisUser = this.userRepository.findOne({ username: username });</span>
    <span class="c1">// const thisEmail = this.userRepository.findOne({ email: email });</span>

    <span class="c1">// create new user</span>
    <span class="kd">let</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserEntity</span><span class="p">();</span>
    <span class="nx">newUser</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">email</span><span class="p">;</span>
    <span class="nx">newUser</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">password</span><span class="p">;</span>
    <span class="nx">newUser</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">validate_error</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">validate_error</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">_error</span> <span class="o">=</span> <span class="p">{</span> <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">UserInput is not valid check type</span><span class="dl">'</span> <span class="p">};</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpException</span><span class="p">(</span>
        <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Input data validation failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">_error</span> <span class="p">},</span>
        <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>먼저 username 과 email 은 유일해야 하기 때문에 이를 검사해보죠!!</p>

<p>먼저 살펴볼 것은 <code class="language-plaintext highlighter-rouge">createQueryBuilder</code> 입니다.
typeorm 은 <code class="language-plaintext highlighter-rouge">createQueryBuilder</code> 라는 함수를 통해 코드 안에서 SQL 문을 작성할 수 있게 해줍니다.
이 코드로 인해 작성된 sql 문은 바로 실행되는 것이 아니라 실질적으로 DB 와 데이터 교환이 일어나면 실행 됩니다.</p>

<p>맨 처음 만든 SQL 문은</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">byEmail</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getByEmail</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
</code></pre></div></div>

<p>여기서 수행 됩니다. DB 의 쿼리 속도와 우리가 만든 백엔드 서버에서 코드를 실행하는 속도 차이가 많이 나기 때문에 비동기 식으로 수행했습니다.</p>

<p>마찬가지로 username 도 검사해줍시다!!</p>

<p>사실 이 기능은 createQueryBuilder 를 안써도 됩니다. Repository 를 작성했으므로 기본적인 기능은 이미 지원이 되기 때문입니다.
예들 들어 username 을 기준으로 가져오고 싶다면 다음과 같이 적으면 됩니다.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">username</span><span class="p">:</span> <span class="nx">username</span> <span class="p">});</span>
</code></pre></div></div>

<p>이해를 돕고자 <code class="language-plaintext highlighter-rouge">createQueryBuilder</code> 를 사용했습니다</p>

<p>마찬가지로 findByEmail 함수를 다음과 같이 사용하시면</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">async</span> <span class="nx">findByEmail</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">email</span> <span class="p">});</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>email 기준으로 유저를 찾을 수 있습니다!!</p>

<h2 id="-module-에-import-해주기">🔨 Module 에 import 해주기!!</h2>

<p>자 거의 다 왔습니다!!</p>

<p><code class="language-plaintext highlighter-rouge">users.module.ts</code> 파일 안에 imports 부분에 다음과 같이 모듈을 import 해줍시다!!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forFeature</span><span class="p">([</span><span class="nx">UserRepository</span><span class="p">])],</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">UsersController</span><span class="p">],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">UsersService</span><span class="p">],</span>
  <span class="na">exports</span><span class="p">:</span> <span class="p">[</span><span class="nx">UsersService</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersModule</span> <span class="p">{}</span>
</code></pre></div></div>

<h2 id="-이제-실행된다">😃 이제 실행된다!!</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run start
</code></pre></div></div>

<p>위 명령어를 통해 어플리케이션을 실행을 합시다.
오류가 없다면 다음과 같이 로그가 뜹니다!!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [NestFactory] Starting Nest application...
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [InstanceLoader] TypeOrmModule dependencies initialized +97ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [InstanceLoader] AppModule dependencies initialized +1ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [InstanceLoader] TypeOrmCoreModule dependencies initialized +213ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [InstanceLoader] TypeOrmModule dependencies initialized +1ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [InstanceLoader] UsersModule dependencies initialized +1ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RoutesResolver] AppController {}: +14ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {, GET} route +18ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RoutesResolver] UsersController {/users}: +10ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {/users, POST} route +7ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {/users, GET} route +3ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {/users/:email, GET} route +1ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {/users/:id, PUT} route +11ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [RouterExplorer] Mapped {/users/:id, DELETE} route +1ms
[Nest] 33080   - 2021-02-01 2:36:58 ├F10: PM┤   [NestApplication] Nest application successfully started +2ms
</code></pre></div></div>

<p>우후 우후~ 우후~ 우후~ 성공!!
고생하셨습니다.</p>

<h2 id="-아직-테스트가-남았다">🤣 아직 테스트가 남았다!!!</h2>

<p>저는 Rest Client 라는 vscode extension 을 이용하여 테스트를 진행했습니다. postman, curl 여러분이 편하신 툴을 이용해주세요!!</p>

<p>자 다음과 같이 요청을 하면!</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">    </span><span class="nf">POST</span> <span class="nn">http://localhost:3000/users</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">    Content-Type: application/json</span>

    {
        "username": "manynang",
        "email" : "nono@cat.co.kr",
        "password" : "manyang"
    }
</code></pre></div></div>

<p>다음과 같이 데이터가 출력이 됩니다!!</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">    </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="s">    X-Powered-By: Express</span>
<span class="s">    Content-Type: application/json; charset=utf-8</span>
<span class="s">    Content-Length: 179</span>
<span class="s">    ETag: W/"b3-G/i5vHuN9KZDYAV9wTSwyMToetE"</span>
<span class="s">    Date: Mon, 01 Feb 2021 05:41:10 GMT</span>
<span class="s">    Connection: close</span>

    {
    "email": "nono@cat.co.kr",
    "password": "$argon2i$v=19$m=4096,t=3,p=1$LthoEnjA4KlaeaE/8YhMPg$2bNUqzjlCqbomBtDTkcYzTHjibaSrjefgJDzJWTvGFQ",
    "username": "manynang",
    "id": 1,
    "imageLink": ""
    }
</code></pre></div></div>

<p>웁스 .. 비밀번호가 나오는군요… 이래서 테스트가 중요한겁니다.</p>

<p>저희는 유저 id만 가져오도록 하겠습니다.
UserCreate save 하는 부분을</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">newUser</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre></div></div>

<p>이와 같이 바꿔줍시다.</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">    </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="s">    X-Powered-By: Express</span>
<span class="s">    Content-Type: text/html; charset=utf-8</span>
<span class="s">    Content-Length: 1</span>
<span class="s">    ETag: W/"1-NWoZK3kTsExUV00Ywo1G5jlUKKs"</span>
<span class="s">    Date: Mon, 01 Feb 2021 05:50:44 GMT</span>
<span class="s">    Connection: close</span>

    1
</code></pre></div></div>

<p>자 성공!</p>

<p>자 다시 위에 POST 관련 문을 다시 보내면?</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">    </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="s">    X-Powered-By: Express</span>
<span class="s">    Content-Type: application/json; charset=utf-8</span>
<span class="s">    Content-Length: 92</span>
<span class="s">    ETag: W/"5c-j/u2GjtMeXEpPJw+5WWgYELKwpM"</span>
<span class="s">    Date: Mon, 01 Feb 2021 05:54:56 GMT</span>
<span class="s">    Connection: close</span>

    {
    "message": "Input data validation falied",
    "error": {
        "username": "UserName is already exists"
    }
    }
</code></pre></div></div>

<p>성공~~!!!!
중복된 username 을 걸렀습니다 ㅜㅜ!!</p>

<hr />

<p>고생했습니다 ㅜㅜ!!!!</p>

<p>다음에는 위 코드를 Refactor 하는 과정으로 찾아뵙도록 하겠습니다!!
오늘도 즐거운 하루 보내세요!!</p>

<p>피드백은 항상 환영입니다.</p>

    <hr />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://tocktock.github.io/algorithms/algorithms-leetcode-45/"> leetcode Jump Game II 문제풀기 </a>
    </h1>

    <span class="post-date">30 Jan 2021</span>

    <p>#[leetcode][45] Jump Game II 문제풀기!</p>

<hr />

<ul>
  <li><a href="https://leetcode.com/problems/jump-game-ii">문제풀러가기✈</a></li>
</ul>

<hr />

<h2 id="-문제-요약">👓 문제 요약</h2>

<p>처음 인덱스에서 마지막 인덱스에 도달하려면 몇 번 점프해야할까?
해당 인덱스에서 최대 얼마나 뛸 수 있는지는 알려줄게!</p>

<blockquote>
  <p>자세한 문제 설명과 릿코드 홈페이지 참고. <a href="https://leetcode.com/problems/jump-game-ii">문제풀러가기</a></p>
</blockquote>

<h2 id="-문제-풀이">🔑 문제 풀이</h2>

<p>주어지는 인풋의 길이가 최대 30,000 이기 때문에 최소 O(nlgn) 기법을 써야 합니다!</p>

<p>저는 탐욕 기법으로 해당 인덱스에서 뛰었을 때 최대로 가는 놈만 골라서 그냥 뛰었습니다!</p>

<h2 id="-소스코드-및-소스해석">🥽 소스코드 및 소스해석</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">jump</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">nowPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">maxNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">dist</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">dist</span> <span class="o">&lt;=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">dist</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">maxNum</span> <span class="o">&lt;=</span> <span class="nx">dist</span> <span class="o">+</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">dist</span><span class="p">]</span> <span class="o">||</span> <span class="nx">dist</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">maxNum</span> <span class="o">=</span> <span class="nx">dist</span> <span class="o">+</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">dist</span><span class="p">];</span>
        <span class="nx">nowPos</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">dist</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="nx">nowPos</span><span class="p">;</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nowPos</span> <span class="o">&gt;=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="-문제-후기">🔨 문제 후기</h2>

<p>왜 hard 난이도 인지 알 수 없는 문제!! 끄앗!!!</p>

    <hr />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://tocktock.github.io/algorithms/algorithms-leetcode-44/"> leetcode Wildcard Matching 문제풀기 </a>
    </h1>

    <span class="post-date">30 Jan 2021</span>

    <p>#[leetcode][44] Wildcard Matching 문제풀기!</p>

<hr />

<ul>
  <li><a href="https://leetcode.com/problems/wildcard-matching">문제풀러가기✈</a></li>
</ul>

<hr />

<h2 id="-문제-요약">👓 문제 요약</h2>

<p>간단한 정규식 패턴을 줄게.</p>

<ul>
  <li><strong>’?’</strong> 이건 하나의 문자를 대체할 수 있는 놈이야.</li>
  <li><strong>’*‘</strong> 임마 이거는 빈 문자를 포함해서 문자열을 대체할 수 있는 놈이야.</li>
</ul>

<p>자 이제 내가 문자열을 줄테니까 이전에 준 패턴으로 만들 수 있는 놈인지 판단해줘!</p>

<blockquote>
  <p>자세한 문제 설명과 릿코드 홈페이지 참고. <a href="https://leetcode.com/problems/wildcard-matching">문제풀러가기</a></p>
</blockquote>

<h2 id="-문제-풀이">🔑 문제 풀이</h2>

<p>문제에서 문자열의 길이와 패턴의 길이가 최대 2,000 이기 때문에 <strong>O(n^2)</strong> 으로도 가능한 문제입니다!!</p>

<p>저는 DP 기법으로 풀었습니다.</p>

<p><strong>dp[i][j]</strong> 는 0 ~ i - 1 까지의 패턴으로, 0 ~ j - 1 까지의 문자열을 만족할 수 있는지에 대한 정보를 나타냅니다.</p>

<p>이 문제의 경우 패턴의 인덱스가 0 이거나 문자열의 인덱스가 0 인 경우에 대한 처리가 복잡해질거 같아서</p>

<p>인덱스를 하나씩 더 써서 사용 했습니다.
즉 dp[0][0] 은 패턴 0개, 문자열 0개를 사용했을 때를 나타냅니다.</p>

<p>검사하려는 i - 1 의 패턴이 <strong>’*‘</strong> 인 경우와 <strong>’?’</strong> 또는 <strong>알파벳문자</strong> 인 경우로 나누었습니다.</p>

<ul>
  <li><strong>’*‘</strong> 인 경우 : 이 경우는 즉 현재 패턴을 뺀 경우 또는 현재 검사하려는 문자열에서 마지막 문자를 뺀 경우가 만족하면 true 입니다. -&gt; dp[i - 1][j] 또는 dp[i][j - 1] 가 true 이면 dp[i][j] 는 true</li>
  <li><strong>’?’</strong> 또는 <strong>알파벳문자</strong> 인 경우 : 이 경우는 현재 패턴과 검사하려는 문자열의 마지막 문자를 뺀 경우 만족하면 true 입니다. -&gt; dp[i - 1][j - 1] 가 true 이면 dp[i][j] 는 true</li>
</ul>

<h2 id="-소스코드-및-소스해석">🥽 소스코드 및 소스해석</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">isMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//remove consecutive star e.g) **</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">patternTemp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">)</span> <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">patternTemp</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="nx">p</span> <span class="o">=</span> <span class="nx">patternTemp</span><span class="p">;</span>
  <span class="c1">// dp[i][j] measn from p[0] ~ p[i]</span>
  <span class="kd">let</span> <span class="nx">dp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">fill</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">//dp[pattern][string]</span>

  <span class="nx">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">patternIdx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">patternIdx</span> <span class="o">&lt;=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">patternIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">stringIdx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">stringIdx</span> <span class="o">&lt;=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">stringIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">patternIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dp</span><span class="p">[</span><span class="nx">patternIdx</span><span class="p">][</span><span class="nx">stringIdx</span><span class="p">]</span> <span class="o">=</span>
          <span class="nx">dp</span><span class="p">[</span><span class="nx">patternIdx</span><span class="p">][</span><span class="nx">stringIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="nx">dp</span><span class="p">[</span><span class="nx">patternIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">stringIdx</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>
        <span class="nx">p</span><span class="p">[</span><span class="nx">patternIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">?</span><span class="dl">"</span> <span class="o">||</span>
        <span class="nx">p</span><span class="p">[</span><span class="nx">patternIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">s</span><span class="p">[</span><span class="nx">stringIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
      <span class="p">)</span> <span class="p">{</span>
        <span class="nx">dp</span><span class="p">[</span><span class="nx">patternIdx</span><span class="p">][</span><span class="nx">stringIdx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dp</span><span class="p">[</span><span class="nx">patternIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">stringIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">dp</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">][</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">];</span>
</code></pre></div></div>

<h2 id="-문제-후기">🔨 문제 후기</h2>

<p>처음에 패턴이 0 인 경우 문자열이 0 인 경우 다 나누고 있다가 이게 뭔 짓이람 하고 인덱스를 하나 늘려서 그냥 저장했더니 더 간결해졌다.</p>

<p>항상 알고리즘이 동일하다면 더 간결하게 쓰기 위해 노력해야겠다!!</p>

    <hr />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://tocktock.github.io/elasticsearch/elasticsearch-search-query/"> Elasticsearch search query 집중탐구 - 1 </a>
    </h1>

    <span class="post-date">26 Jan 2021</span>

    <p>#[🌎elasticsearch] search query 집중탐구 - 1 전처리 과정</p>

<hr />

<ul>
  <li>
    <p><a href="https://esbook.kimjmin.net/">Elasticsearch 가이드북 ✈</a></p>
  </li>
  <li>
    <p><a href="https://www.elastic.co/kr/what-is/elasticsearch">Elasticsearch 홈페이지 가기 ✈</a></p>
  </li>
</ul>

<hr />

<h2 id="-elasitcsearch-full-text-search-의-원리">🧡 ElasitcSearch Full-Text-Search 의 원리</h2>

<h3 id="inverted-index">🙂Inverted Index</h3>

<p>Elasticsearch 는 “text” 로 매핑된 필드의 경우 그 안에 데이터를 Inverted Index 라는 구조로 저장합니다.</p>

<p>직역하자면 역 색인, 반대 색인 이런 뜻인데 대충 감이 오시나요??</p>

<p>예들 들어보겠습니다.
아래와 같은 데이터가 있다고 합시다.</p>

<table>
  <thead>
    <tr>
      <th>Id</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>“Cat is Cute”</td>
    </tr>
    <tr>
      <td>2</td>
      <td>“Dog is Cute Too”</td>
    </tr>
    <tr>
      <td>3</td>
      <td>“Cat is lazy”</td>
    </tr>
    <tr>
      <td>4</td>
      <td>“Dog is super athletic”</td>
    </tr>
  </tbody>
</table>

<p>일반적인 DBMS 에서는 <strong>“athletic”</strong> 을 검색하고 싶다하면 1번 ,2번, 3번, 4번 순서로 검색해서
<strong>“athleti”</strong> 이 있구나 Id 4를 보여줘야지. 라고 할 겁니다.</p>

<p>Inverted Index 는 조금 다릅니다.
토큰마다 값을 가지는데, 이 값은 “이 문서에 이 토큰 값이 포함되어 있어.”를 저장합니다.
위의 테이블을 아래와 같은 식으로 저장합니다.</p>

<table>
  <thead>
    <tr>
      <th>Token</th>
      <th>Id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>“cat”</td>
      <td>1, 3</td>
    </tr>
    <tr>
      <td>“dog”</td>
      <td>2, 4</td>
    </tr>
    <tr>
      <td>“cute”</td>
      <td>1, 2</td>
    </tr>
    <tr>
      <td>“lazy”</td>
      <td>3</td>
    </tr>
    <tr>
      <td>“athletic”</td>
      <td>4</td>
    </tr>
    <tr>
      <td>“super”</td>
      <td>4</td>
    </tr>
  </tbody>
</table>

<p>이 같은 경우 “athletic” 토큰이 포함된 4번 문서만 보면 됩니다. 다만 토큰을 빨리 찾기 위해 저장하는 자료구조는 좀 복잡해질겁니다.
괜찮습니다. <strong>Elasticsearch 가 대신해줄거거든요!!</strong></p>

<p>🛑🛑 단 이렇게 저장되는 건 오직 필드가 <strong>text</strong> 타입일 때만 적용됩니다.
다른말로 하자면 text 필드가 아니면 전문검색 기능을 쓸 수 없습니다!!</p>

<h3 id="analizer">🙂Analizer</h3>

<p>위의 예시에서 눈치채신 분도 계시겠지만, 처음 테이블의 내용을 Inverted Index 방법으로 저장할 때 전부 소문자로 바뀌어서 저장이 되었습니다.
그리고 저장되지 않은 단어들도 있군요. 이 과정을 <strong>Text Analysis</strong> 라고 합니다.
이 과정을 거치지 않고 진행하게 되면 검색에 필요 없는단어 가령 “is”, “too” 까지 저장해야합니다.</p>

<p>우리가 “dOG” 라고 검색해도 “Dog” 가 포함된 문서를 보고 싶다면 토큰화하는 과정에 전처리 과정을 수행해야합니다.</p>

<h4 id="1-character-filter">1. Character Filter</h4>

<p><strong>Character Filter</strong> 는 전처리과정에서 가장 먼저 수행되는 과정입니다.
<strong>Character Filter</strong> 에는 <strong>HTML Strip, Mapping, Pattern Replace</strong> 세 가지가 존재합니다.</p>

<ul>
  <li><strong>HTML Strip</strong> : 문장에 HTML 태그들을 없애주는 Filter 입니다. 예를들면,
<code class="language-plaintext highlighter-rouge">&lt;p&gt;I&amp;apos;m so &lt;b&gt;happy&lt;/b&gt;!&lt;/p&gt;</code> 라는 문장을 <code class="language-plaintext highlighter-rouge">I'm so happy!</code> 로 바꿔줍니다.</li>
  <li><strong>Mapping</strong> : 특정 문자열을 내가 원하는 값으로 대체할 수 있습니다.</li>
  <li><strong>Pattern Replace</strong> : 특정 정규식 패턴을 내가 원하는 값으로 대체할 수 있습니다.</li>
</ul>

<h4 id="2-tokenizer-filter">2. Tokenizer Filter</h4>

<p><strong>Tokenizer Filter</strong> 는 문자열을 받아 단어들을 토큰화하는 과정입니다.
Tokenizer Filter 는 많은 종류가 있는데 대표적인 3가지를 먼저 알아보겠습니다.</p>

<ul>
  <li><strong>Standard</strong> : 토큰화 할 때 <strong>공백과 hyphen(-)을</strong> 기준으로 토큰화를 수행하며, 일부 특수문자를 제거합니다.</li>
  <li><strong>Letter</strong> : 토큰화 할 때 <strong>문자열 이외</strong>를 기준으로 토큰화를 수행합니다.
예들 들어 <code class="language-plaintext highlighter-rouge">Brown-Foxes dog's</code> 같은 문자열은 [Brown, Foxes, dog, s] 로 토큰화를 수행합니다.</li>
  <li><strong>Whitespace</strong> : <strong>공백</strong> 을 기준으로 토큰화를 수행합니다. 공백, 줄바꿈, 탭 모든 공백을 포함합니다.</li>
</ul>

<blockquote>
  <p>Email, URL, Path 와 특수 목적용 Tokenizer 들이 많으니 자세한 정보는 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html">Tokenizer Document</a> 를 참조해주시와요.!!</p>
</blockquote>

<h4 id="3-token-filter">3. Token Filter</h4>

<p><strong>Token Filter</strong> 는 각 Tokenizer Filter 에 의해 만들어진 Token 들에 대한 후처리 작업을 수행합니다.
가장 대표적인 Lowercase Token Filterr 로 Stop Token Filterr 가 있습니다.</p>

<ul>
  <li><strong>Lowercase</strong> : 말 그대로 토큰들을 소문자로 <strong>바꾸는</strong> Token filter 입니다.</li>
  <li><strong>Stop</strong> : Search 기능에 필요 없는 단어들 예를 들면 is, be, to, a, as 등을 없애는 필터입니다.</li>
</ul>

<blockquote>
  <p>더 많은 Token filter 를 보고 싶으면 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/analysis-tokenfilters.html">Token Filters</a> 를 참조해주세요!! 오른쪽 메뉴바에 다양한 Token filters 가 있습니다.</p>
</blockquote>

<h4 id="4-stemming">4. Stemming</h4>

<p>또한 각 토큰들은 그 원형을 유지할 필요가 있습니다. 예를 들면 <code class="language-plaintext highlighter-rouge">working</code> 에서 <code class="language-plaintext highlighter-rouge">ing</code> 는 필요 없는 부분이며 우리는 work 만 검색하면 됩니다.
이러한 과정을 Stemming 이라고 합니다.</p>

<h4 id="etc">ETC</h4>

<p>우리가 문서에 영어만 쓰는 것은 아닙니다. 대부분 그 나라에서는 그 나라 언어를 많이 쓸 것입니다.
ElasticSearch 에 내장된 언어분석기가 없다면, Full-Text-Search 에 난항을 겪을지도 모릅니다.
다행이도 한글의 경우는 Nori 한글 형태소 분석기를 이용하여 이 과정을 수행합니다.</p>

<blockquote>
  <p>자세한 내용은 Elasticsearch Document 를 참고해주세요!! <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/7.10/analysis-nori.html">Nori Analysis Plugin 구경하기</a></p>
</blockquote>

<hr />

<p>위 과정을 통해 저장된 토큰들을 통해 Search API 기능들을 수행합니다.</p>

<p>다음에는 query 를 통해 실제 예제로 찾아뵙겠습니다.</p>

<p>피드백은 항상 환영입니다.</p>

    <hr />
  </div>
  
</div>

<div class="pagination">
  
  <a
    class="pagination-item older"
    href="https://tocktock.github.io/page2"
    >Older</a
  >
   
  <span class="pagination-item newer">Newer</span>
  
</div>
</div>
  
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src="/public/js/script.js"></script>
  </body>
</html>
