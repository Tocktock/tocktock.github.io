<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />

  <title>
     NestJS ë¸”ë¡œê·¸ ë§Œë“¤ê¸° - ë¦¬íŒ©í† ë§ê³¼ e2e í…ŒìŠ¤íŠ¸!! &middot; ì˜ì› 
  </title>

  
  <link rel="canonical" href="https://tocktock.github.io/nestjs/nestjs-4-testing/" />
  

  <link rel="stylesheet" href="https://tocktock.github.io/public/css/poole.css" />
  <link rel="stylesheet" href="https://tocktock.github.io/public/css/syntax.css" />
  <link rel="stylesheet" href="https://tocktock.github.io/public/css/lanyon.css" />

  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400"
  />

  <link
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
    href="https://tocktock.github.io/public/apple-touch-icon-precomposed.png"
  />
  <link rel="shortcut icon" href="https://tocktock.github.io/public/favicon.ico" />

  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS"
    href="https://tocktock.github.io/atom.xml"
  />

  <!-- <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "//www.google-analytics.com/analytics.js",
      "ga"
    );
    ga("create", "UA-178749172-1", "auto");
    ga("send", "pageview");
  </script> -->
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" />

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item description">
    <p>Developer with Cat</p>
  </div>

  <nav class="sidebar-nav">
    <a
      class="sidebar-nav-item"
      href="https://tocktock.github.io/"
      >Home</a
    >
                
    <div>
      <a
        class="sidebar-nav-item"
        href="https://tocktock.github.io/about/"
        >About me</a
      >
               
    <div>
      <a
        class="sidebar-nav-item"
        href="https://tocktock.github.io/categories/"
        >Categories</a
      >
      
      <ul class="sidebar-categories">
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/Algorithms"
            >Algorithms (28)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/Jekyll"
            >Jekyll (1)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/elasticsearch"
            >elasticsearch (9)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/NestJS"
            >NestJS (4)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/DevTip"
            >DevTip (1)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/nodejs"
            >nodejs (2)</a
          >
        </li>
         
        <li class="sidebar-categories-item">
          <a href="https://tocktock.github.io/categories/redux"
            >redux (1)</a
          >
        </li>
        
      </ul>
                                                                           
    </div>

    <a class="sidebar-nav-item" href="https://github.com/Tocktock/tocktock.github.io">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">ì˜ì›</a>
            <small>ì›¹ ê°œë°œê³¼ ì¼ìƒ</small>
          </h3>
        </div>
      </div>

      <div class="container content"><div class="post">
  <h1 class="post-title">NestJS ë¸”ë¡œê·¸ ë§Œë“¤ê¸° - ë¦¬íŒ©í† ë§ê³¼ e2e í…ŒìŠ¤íŠ¸!!</h1>
  <span class="post-date">09 Feb 2021</span>
  <h1 id="2-nestjs-ë¸”ë¡œê·¸-ë§Œë“¤ê¸°---ë¦¬íŒ©í† ë§ê³¼-e2e-í…ŒìŠ¤íŠ¸">2. NestJS ë¸”ë¡œê·¸ ë§Œë“¤ê¸° - ë¦¬íŒ©í† ë§ê³¼ e2e í…ŒìŠ¤íŠ¸!!</h1>

<p>ì´ë²ˆì—ëŠ” ì´ì „ í¬ìŠ¤íŠ¸ì—ì„œ ë‹¤ë¤˜ë˜ ë‚´ìš©ì— ëŒ€í•´ì„œ Refactoring ì„ í•˜ê³  í…ŒìŠ¤íŠ¸ë„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="-refactoring-">ğŸ”¨ Refactoring !!</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€modules
    â””â”€user
        â”‚  user.controller.ts
        â”‚  user.module.ts
        â”‚  user.repository.ts
        â”‚  user.service.ts
        â”‚  user.spec.ts
        â”‚
        â”œâ”€dto
        â”‚      create-user.dto.ts
        â”‚      index.ts
        â”‚      update-user.dto.ts
        â”‚
        â”œâ”€entities
        â”‚      user.entity.ts
        â”‚
        â”œâ”€exceptions
            email-already-exist-exception.ts
            user-not-found.exception.ts
            username-already-exist-exception.ts
</code></pre></div></div>

<p>ê³„ì† ë¦¬íŒ©í† ë§ í•˜ë‹¤ë³´ë‹ˆ ìœ„ì™€ ê°™ì€ êµ¬ì¡°ê°€ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.
íŒŒì¼ ì´ë¦„ì´ ë°”ë€ ê²ƒë„ ìˆê³ , ë‚´ë¶€ êµ¬í˜„ì‚¬í•­ì´ ë°”ë€ ê²ƒë„ ìˆìŠµë‹ˆë‹¤.
ë¦¬íŒ©í† ë§ í•˜ë©´ì„œ ì„¤ê³„ì˜ ì¤‘ìš”ì„±ì„ ë‹¤ì‹œ ëŠë‚ë‹ˆë‹¤.</p>

<h3 id="userexceptions">user.exceptions</h3>

<p>Custom Exception ì„ ë§Œë“¤ê¸° ìœ„í•´ user í´ë” ì•ˆì— exceptions í´ë”ë¥¼ ë§Œë“­ì‹œë‹¤!</p>

<p>ì´ë©”ì¼ê³¼ ìœ ì €ë„¤ì„ì´ ì¤‘ë³µ ë˜ì—ˆì„ ë•Œ ê·¸ë¦¬ê³  ìœ ì €ë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë•Œ ë°œìƒ ì‹œí‚¬ exception ì„ ê°ê° ë§Œë“¤ì–´ ì¤ì‹œë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">username-already-exist-exception.ts</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BadRequestException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsernameAlreadyExistException</span> <span class="kd">extends</span> <span class="nx">BadRequestException</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="dl">"</span><span class="s2">username already exist</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">email-already-exist-exception.ts</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BadRequestException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">EmailAlreadyExistException</span> <span class="kd">extends</span> <span class="nx">BadRequestException</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="dl">"</span><span class="s2">email already exist</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">user-not-found.exception.ts</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BadRequestException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserNotFoundException</span> <span class="kd">extends</span> <span class="nx">BadRequestException</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="dl">"</span><span class="s2">user not found</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ê°ê°ì˜ í´ë˜ìŠ¤ëŠ” BadRequestException ì„ ìƒì†ë°›ê³  ìˆìŠµë‹ˆë‹¤.
í•´ë‹¹ Exception ì„ ë°œìƒì‹œí‚¤ë©´ Status Code ëŠ” 400(BadRequest) ì´ ë°œìƒë©ë‹ˆë‹¤.</p>

<p>ë§¤ìš° ê°„ë‹¨í•˜ê²Œ Custom Exception ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤!!</p>

<h3 id="userservice">user.service</h3>

<p>create ë©”ì†Œë“œ ì•ˆì—ì„œ ì´ì „ì— ë§Œë“¤ì—ˆë˜ QueryBuilder ë¶€ë¶„ì„ ì‚­ì œí•˜ê³  ë°”ë¡œ ìœ„ì—ì„œ ë§Œë“¤ì—ˆë˜ Custom Exceptions ë“¤ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">UserService.create</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">thisUser</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">username</span><span class="p">:</span> <span class="nx">username</span> <span class="p">});</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">thisUser</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">UserName is already exist</span><span class="dl">"</span><span class="p">;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">UsernameAlreadyExistException</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">thisEmail</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">email</span> <span class="p">});</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">thisEmail</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Email is already exist</span><span class="dl">"</span><span class="p">;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">EmailAlreadyExistException</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  ìœ ì €ë¥¼ ì €ì¥í•˜ì—¬ ë°˜í™˜í•  ë•Œ ë‹¨ìˆœ number ê°’ì´ ì•„ë‹ˆë¼ Object ë¥¼ ë°˜í™˜í•´ì¤ì‹œë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">newUser</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="k">return</span> <span class="p">{</span> <span class="na">userId</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">};</span>
</code></pre></div></div>

<p>í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ remove ë©”ì†Œë“œ ì•ˆì˜ ë‚´ìš©ì„ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ì–´ ì¤ì‹œë‹¤.</p>

<blockquote>
  <p>ì´í›„ Auth ê´€ë ¨ ê¸°ëŠ¥ì„ ë§Œë“¤ë©´ì„œ remove ê¸°ëŠ¥ì€ ì‚¬ë¼ì§ˆê²ë‹ˆë‹¤â€¦</p>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">UserService.remove</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">DeleteResult</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">email</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="usercontroller">user.controller</h3>

<p>remove ì™€ ê´€ë ¨ëœ controller ë¶€ë¶„ì„ ë‹¤ìŒìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”!</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">UsersController.remove</code></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">@</span><span class="nd">Delete</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
  <span class="nx">remove</span><span class="p">(@</span><span class="nd">Body</span><span class="p">(</span><span class="dl">'</span><span class="s1">email</span><span class="dl">'</span><span class="p">)</span> <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">usersService</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">email</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@Body</code> annotation ì€ response body ì•ˆì—ì„œ í•´ë‹¹í•˜ëŠ” í•„ë“œë¥¼ ê°€ì ¸ì™€ ë³€ìˆ˜ì— ì…ë ¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤!!</p>

<h2 id="ìƒˆí•´-ì²«-í…ŒìŠ¤íŠ¸-ë‘ê·¼ë‘ê·¼">ğŸ§¡ğŸ§¡ìƒˆí•´ ì²« í…ŒìŠ¤íŠ¸ ë‘ê·¼ë‘ê·¼</h2>

<p>ë¨¼ì € ìœ ë‹›í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ, e2e í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ìœ„í•œ ì½”ë“œì„ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.
í…ŒìŠ¤íŠ¸ ê´€ë ¨ ê¸°ìˆ ì´ ë§ì´ ë¶€ì¡±í•´ì„œ ê³„ì† ê³µë¶€ì¤‘ì…ë‹ˆë‹¤. ã…œã…œ ë” ì•Œì•„ê°€ë©´ì„œ í¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸ í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!!</p>

<p>í…ŒìŠ¤íŠ¸ëŠ” í•´ë‹¹ url ë¡œ ìš”ì²­ ìˆ˜í–‰ì‹œ ì ì ˆí•œ ì‘ë‹µì´ ì˜¤ëŠ” í™•ì¸í•©ë‹ˆë‹¤.</p>

<p>e2e í…ŒìŠ¤íŠ¸ ë°©ë²•ì— ì •ì„ì´ ìˆê² ì§€ë§Œ ì§„í–‰ ë„ì¤‘ ë§ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬.. ì¼ë‹¨ ì•¼ë§¤ë¡œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p><strong>ì„œë²„ì‹¤í–‰ -&gt; urlë¡œ ìš”ì²­</strong></p>

<p>ìš”ì²­ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ supertest ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¨¼ì € ì„¤ì¹˜í•©ì‹œëŒœ!!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save-dev</span> supertest
</code></pre></div></div>

<blockquote>
  <p>supertest ê´€í•œ ë‚´ìš©ì€ ë‹¤ìŒë§í¬ì—ì„œ ë” í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤!!
<a href="https://www.npmjs.com/package/supertest">npm supertest</a></p>
</blockquote>

<p>ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•œ nest ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì„¤ì¹˜í•©ì‹œë‹¤ !!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i <span class="nt">--save-dev</span> @nestjs/testing
</code></pre></div></div>

<p>ì´ì œ user.spec.ts ë¼ëŠ” íŒŒì¼ì„ user í´ë” ì•ˆì— ìƒì„±í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•©ì‹œë‹¤!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">request</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">supertest</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">User create í…ŒìŠ¤íŠ¸</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test1@example.com</span><span class="dl">"</span> <span class="p">});</span>
    <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test2@example.com</span><span class="dl">"</span> <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">email ì¤‘ë³µ í™•ì¸</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test1@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testuser</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test1@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">abcd</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">error</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email is already exist</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">username ì¤‘ë³µ í™•ì¸</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test2@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testuser</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test1@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testuser</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">12345</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">error</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">"</span><span class="s2">UserName is already exist</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">describe</code> ë©”ì†Œë“œë¡œ í…ŒìŠ¤íŠ¸ í•  ë†ˆë“¤ì„ ê·¸ë£¹í™” í•´ì¤ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">beforeEach</code> ë©”ì†Œë“œë¥¼ í†µí•´ ê° í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ í…ŒìŠ¤íŠ¸ ìœ ì €ë¥¼ ì‚­ì œí•´ì¤ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">it</code> ë©”ì†Œë“œë¥¼ í†µí•´ ê°ê° í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">it</code> ì€ <code class="language-plaintext highlighter-rouge">test</code> ë©”ì†Œë“œì™€ ê°™ì€ ê¸°ëŠ¥ì„ í•˜ë©° ë³„ì¹­ì…ë‹ˆë‹¤.</li>
</ul>

<p>ì ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•´ë´…ì‹œë‹¤!!</p>

<p>ë¨¼ì € ì„œë²„ì‹¤í–‰!!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run start
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ë„ ì‹¤í–‰ !!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run <span class="nb">test</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; nestjs-practice@0.0.1 test C:\Users\jiyoung\nestjs-practice
&gt; jest

PASS  src/modules/user/user.spec.ts
User create í…ŒìŠ¤íŠ¸
    âˆš email ì¤‘ë³µ í™•ì¸ (173 ms)
    âˆš username ì¤‘ë³µ í™•ì¸ (24 ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        1.392 s, estimated 5 s
Ran all test suites.
</code></pre></div></div>

<p>ë‹¤ìŒê³¼ ê°™ì´ í†µê³¼í•˜ë©´ ì„±ê³µì…ë‹ˆë‹¤!!</p>

<blockquote>
  <p>package.json ì—ì„œ jest ê´€ë ¨ ì„¤ì •ì„ spec ë˜ëŠ” test ê°€ ë¶™ì€ ts íŒŒì¼ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ì€ ëª¨ë‘ í…ŒìŠ¤íŠ¸í•˜ê²Œ ë©ë‹ˆë‹¤!!</p>
</blockquote>

<hr />

<p>í…ŒìŠ¤íŠ¸ ê´€ë ¨í•´ì„œëŠ” ì•„ì§ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤ !!
e2e í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € í•´ë³´ê¸° ìœ„í•´ ì‹œë„ëŠ” ë§ì´ í–ˆìœ¼ë‚˜ ê·¸ë§Œí¼ ì˜¤ë¥˜ê°€ ë§ì´ ë‚˜ë”êµ°ìš” ã…œã…œ
ìœ„ì™€ ê°™ì€ ì•¼ë§¤ ë°©ë²•ì„ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ í–ˆìœ¼ë‚˜, ì´í›„ì— í•´ê²°ë°©ë²•ì„ ì•Œì•„ì™€ì„œ í¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸ í•˜ê² ìŠµë‹ˆë‹¤!!</p>

<p>ë˜í•œ ì´í›„ì—ëŠ” Unit Test ê´€ë ¨ ê¸°ëŠ¥ë„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤!</p>

<p>ë‹¤ìŒì—ëŠ” post ëª¨ë“ˆì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤!!
ê°ì‚¬í•©ë‹ˆë‹¤.</p>

<p>í”¼ë“œë°±ì€ í•­ìƒ í™˜ì˜ì…ë‹ˆë‹¤.</p>

  <hr />
</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/nodejs/nodejs-2-eventloop-insideout/">
          Node.js Event loop ì €ìˆ˜ì¤€ì—ì„œ íŒŒí—¤ì¹˜ê¸°
          <small>13 Feb 2021</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/redux/redux-1/">
          Redux ê¸°ë³¸ì„œ!! (feat. react context hook)
          <small>11 Feb 2021</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/nodejs/nodejs-1-what-is-nodejs/">
          Node.js ì˜ íŠ¹ì§•ê³¼ í•œê³„
          <small>01 Feb 2021</small>
        </a>
      </h3>
    </li>
    
  </ul>
</div>

</div>
  
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src="/public/js/script.js"></script>
  </body>
</html>
